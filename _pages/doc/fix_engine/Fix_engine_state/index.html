<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fix_engine_state (fix_engine.Fix_engine_state)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">fix_engine</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Fix_engine_state</span></h1></header><p>FIX 4.4 engine state type.</p><div class="spec type" id="type-manual_int_data"><a href="#type-manual_int_data" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>manual_int_data</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-manual_int_data.session_reset" class="anchored"><td class="def field"><a href="#type-manual_int_data.session_reset" class="anchor"></a><code>session_reset : bool;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>Define set of actions + data for manual intervention by the user.</p></div></div><div class="spec type" id="type-session_data"><a href="#type-session_data" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>session_data</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-session_data.dest_comp_id" class="anchored"><td class="def field"><a href="#type-session_data.dest_comp_id" class="anchor"></a><code>dest_comp_id : <a href="../../core/Base_types/index.html#type-fix_string">Base_types.fix_string</a>;</code></td><td class="doc"><p>(** Destination company ID. *)</p></td></tr></table><code>}</code><code></code></div><div class="doc"><p>Request to initiate a new session.</p></div></div><div class="spec type" id="type-fix_engine_int_inc_msg"><a href="#type-fix_engine_int_inc_msg" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>fix_engine_int_inc_msg</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-fix_engine_int_inc_msg.IncIntMsg_TimeChange" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_inc_msg.IncIntMsg_TimeChange" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">IncIntMsg_TimeChange</span><span class="keyword"> of </span><a href="../../core/Datetime/index.html#type-fix_utctimestamp">Datetime.fix_utctimestamp</a></code></td><td class="doc"><p>(** Updates internal time of the engine. *)</p></td></tr><tr id="type-fix_engine_int_inc_msg.IncIntMsg_CreateSession" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_inc_msg.IncIntMsg_CreateSession" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">IncIntMsg_CreateSession</span><span class="keyword"> of </span><a href="index.html#type-session_data">session_data</a></code></td><td class="doc"><p>(** Create sessions command. *)</p></td></tr><tr id="type-fix_engine_int_inc_msg.IncIntMsg_EndSession" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_inc_msg.IncIntMsg_EndSession" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">IncIntMsg_EndSession</span></code></td><td class="doc"><p>(** Terminate current active session. *)</p></td></tr><tr id="type-fix_engine_int_inc_msg.IncIntMsg_ApplicationData" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_inc_msg.IncIntMsg_ApplicationData" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">IncIntMsg_ApplicationData</span><span class="keyword"> of </span><a href="../../protocol_exts/Full_app_messages/index.html#type-full_app_msg_data">Full_app_messages.full_app_msg_data</a></code></td><td class="doc"><p>(** App messages to be transmitted over. *)</p></td></tr><tr id="type-fix_engine_int_inc_msg.IncIntMsg_ManualIntervention" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_inc_msg.IncIntMsg_ManualIntervention" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">IncIntMsg_ManualIntervention</span><span class="keyword"> of </span><a href="index.html#type-manual_int_data">manual_int_data</a></code></td><td class="doc"><p>(** TODO: create 'richer' manual commands. *)</p></td></tr></table><code></code></div><div class="doc"><p>These are internal messages into the Engine.</p></div></div><div class="spec type" id="type-fix_engine_int_out_msg"><a href="#type-fix_engine_int_out_msg" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>fix_engine_int_out_msg</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-fix_engine_int_out_msg.OutIntMsg_ApplicationData" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_out_msg.OutIntMsg_ApplicationData" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">OutIntMsg_ApplicationData</span><span class="keyword"> of </span><a href="../../protocol_exts/Full_app_messages/index.html#type-full_app_msg_data">Full_app_messages.full_app_msg_data</a></code></td><td class="doc"><p>(** Sending application message *)</p></td></tr><tr id="type-fix_engine_int_out_msg.OutIntMsg_ResendApplicationData" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_out_msg.OutIntMsg_ResendApplicationData" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">OutIntMsg_ResendApplicationData</span><span class="keyword"> of </span><a href="../../protocol_exts/Full_app_messages/index.html#type-full_app_msg_data">Full_app_messages.full_app_msg_data</a></code></td><td class="doc"><p>(** Sending application message that was flagged as a possible resend *)</p></td></tr><tr id="type-fix_engine_int_out_msg.OutIntMsg_Reject" class="anchored"><td class="def constructor"><a href="#type-fix_engine_int_out_msg.OutIntMsg_Reject" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">OutIntMsg_Reject</span></code></td><td class="doc"><p>(** Rejecting internal message - when we cannot transmit or create new sessions, etc. *)</p></td></tr></table><code></code></div><div class="doc"><p>These are the outgoing internal messages - would be sent into the application model.</p></div></div><div class="spec type" id="type-fix_engine_status"><a href="#type-fix_engine_status" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>fix_engine_status</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-fix_engine_status.Normal" class="anchored"><td class="def constructor"><a href="#type-fix_engine_status.Normal" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Normal</span></code></td></tr><tr id="type-fix_engine_status.SessRejectReceived" class="anchored"><td class="def constructor"><a href="#type-fix_engine_status.SessRejectReceived" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">SessRejectReceived</span></code></td></tr><tr id="type-fix_engine_status.BusinessRejectReceived" class="anchored"><td class="def constructor"><a href="#type-fix_engine_status.BusinessRejectReceived" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">BusinessRejectReceived</span></code></td></tr><tr id="type-fix_engine_status.TargetAppIsDown" class="anchored"><td class="def constructor"><a href="#type-fix_engine_status.TargetAppIsDown" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">TargetAppIsDown</span></code></td></tr><tr id="type-fix_engine_status.ConnTerminatedWithoutLogoff" class="anchored"><td class="def constructor"><a href="#type-fix_engine_status.ConnTerminatedWithoutLogoff" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">ConnTerminatedWithoutLogoff</span></code></td></tr><tr id="type-fix_engine_status.MaxNumLogonMsgsViolated" class="anchored"><td class="def constructor"><a href="#type-fix_engine_status.MaxNumLogonMsgsViolated" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">MaxNumLogonMsgsViolated</span></code></td></tr></table><code></code></div><div class="doc"><p>Represents 'status' of the engine.</p></div></div><div class="spec type" id="type-fix_engine_mode"><a href="#type-fix_engine_mode" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>fix_engine_mode</code><code></code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-fix_engine_mode.NoActiveSession" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.NoActiveSession" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">NoActiveSession</span></code></td><td class="doc"><p>(** State of the engine before logon. *)</p></td></tr><tr id="type-fix_engine_mode.LogonInitiated" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.LogonInitiated" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">LogonInitiated</span></code></td><td class="doc"><p>(** Middle of logon session. *)</p></td></tr><tr id="type-fix_engine_mode.ActiveSession" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.ActiveSession" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">ActiveSession</span></code></td><td class="doc"><p>(** Application messages are now processed. *)</p></td></tr><tr id="type-fix_engine_mode.GapDetected" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.GapDetected" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">GapDetected</span></code></td><td class="doc"><p>(** Detected out-of-sequence message. Sending out ResendRequest. *)</p></td></tr><tr id="type-fix_engine_mode.Recovery" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.Recovery" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Recovery</span></code></td><td class="doc"><p>(** RequestResend has been sent out. Waiting to recover the messages, filling int the cache.. *)</p></td></tr><tr id="type-fix_engine_mode.CacheReplay" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.CacheReplay" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">CacheReplay</span></code></td><td class="doc"><p>(** Replaying the cache. *)</p></td></tr><tr id="type-fix_engine_mode.Retransmit" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.Retransmit" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Retransmit</span></code></td><td class="doc"><p>(** Retransmitting sequence of messages because we were asked to retransmit. *)</p></td></tr><tr id="type-fix_engine_mode.ShuttingDown" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.ShuttingDown" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">ShuttingDown</span></code></td><td class="doc"><p>(** We'll nees to send a logoff message adn transition to ShutdownInitiated. *)</p></td></tr><tr id="type-fix_engine_mode.ShutdownInitiated" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.ShutdownInitiated" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">ShutdownInitiated</span></code></td><td class="doc"><p>(** Shutting-down protocol. *)</p></td></tr><tr id="type-fix_engine_mode.Error" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.Error" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Error</span></code></td></tr><tr id="type-fix_engine_mode.WaitingForHeartbeat" class="anchored"><td class="def constructor"><a href="#type-fix_engine_mode.WaitingForHeartbeat" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">WaitingForHeartbeat</span></code></td><td class="doc"><p>(** Sent out TestRequest message. *)</p></td></tr></table><code></code></div><div class="doc"><p>Represents 'modes' of the engine.</p></div></div><div class="spec type" id="type-fix_engine_state"><a href="#type-fix_engine_state" class="anchor"></a><div class="def type"><code><span class="keyword">type </span>fix_engine_state</code><code></code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-fix_engine_state.fe_curr_status" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_curr_status" class="anchor"></a><code>fe_curr_status : <a href="index.html#type-fix_engine_status">fix_engine_status</a>;</code></td><td class="doc"><p>(** Status. *)</p></td></tr><tr id="type-fix_engine_state.fe_curr_mode" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_curr_mode" class="anchor"></a><code>fe_curr_mode : <a href="index.html#type-fix_engine_mode">fix_engine_mode</a>;</code></td><td class="doc"><p>(** High-level mode of the engine. *)</p></td></tr><tr id="type-fix_engine_state.fe_initiator" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_initiator" class="anchor"></a><code>fe_initiator : bool option;</code></td><td class="doc"><p>(** initiator = True if we've received an internal message to initiate
the connection. It's False if we've received a Logon request first.
It's None by default prior to any Logon sequences. *)</p></td></tr><tr id="type-fix_engine_state.fe_curr_time" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_curr_time" class="anchor"></a><code>fe_curr_time : <a href="../../core/Datetime/index.html#type-fix_utctimestamp">Datetime.fix_utctimestamp</a>;</code></td><td class="doc"><p>(** Need to define time so we're aware of heartbeat status. *)</p></td></tr><tr id="type-fix_engine_state.fe_comp_id" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_comp_id" class="anchor"></a><code>fe_comp_id : <a href="../../core/Base_types/index.html#type-fix_string">Base_types.fix_string</a>;</code></td><td class="doc"><p>(** Our company ID *)</p></td></tr><tr id="type-fix_engine_state.fe_target_comp_id" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_target_comp_id" class="anchor"></a><code>fe_target_comp_id : <a href="../../core/Base_types/index.html#type-fix_string">Base_types.fix_string</a>;</code></td><td class="doc"><p>(** Target company ID *)</p></td></tr><tr id="type-fix_engine_state.incoming_int_msg" class="anchored"><td class="def field"><a href="#type-fix_engine_state.incoming_int_msg" class="anchor"></a><code>incoming_int_msg : <a href="index.html#type-fix_engine_int_inc_msg">fix_engine_int_inc_msg</a> option;</code></td><td class="doc"><p>(** Incoming internal messages (application). *)</p></td></tr><tr id="type-fix_engine_state.outgoing_int_msg" class="anchored"><td class="def field"><a href="#type-fix_engine_state.outgoing_int_msg" class="anchor"></a><code>outgoing_int_msg : <a href="index.html#type-fix_engine_int_out_msg">fix_engine_int_out_msg</a> option;</code></td><td class="doc"><p>(** These are messages we send back to our owner *)</p></td></tr><tr id="type-fix_engine_state.incoming_seq_num" class="anchored"><td class="def field"><a href="#type-fix_engine_state.incoming_seq_num" class="anchor"></a><code>incoming_seq_num : int;</code></td><td class="doc"><p>(** Sequence number of the last processed incoming message. *)</p></td></tr><tr id="type-fix_engine_state.outgoing_seq_num" class="anchored"><td class="def field"><a href="#type-fix_engine_state.outgoing_seq_num" class="anchor"></a><code>outgoing_seq_num : int;</code></td><td class="doc"><p>(** Sequence number of the last sent message. *)</p></td></tr><tr id="type-fix_engine_state.incoming_fix_msg" class="anchored"><td class="def field"><a href="#type-fix_engine_state.incoming_fix_msg" class="anchor"></a><code>incoming_fix_msg : <a href="../../protocol/Full_messages/index.html#type-full_top_level_msg">Full_messages.full_top_level_msg</a> option;</code></td><td class="doc"><p>(** Messages we will send out *)</p></td></tr><tr id="type-fix_engine_state.outgoing_fix_msg" class="anchored"><td class="def field"><a href="#type-fix_engine_state.outgoing_fix_msg" class="anchor"></a><code>outgoing_fix_msg : <a href="../../protocol/Full_messages/index.html#type-full_top_level_msg">Full_messages.full_top_level_msg</a> option;</code></td><td class="doc"><p>(** Messages we receive *)</p></td></tr><tr id="type-fix_engine_state.fe_cache" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_cache" class="anchor"></a><code>fe_cache : <a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list;</code></td><td class="doc"><p>(** Maintain a cache of messages in case we detect out-of-sequence message(s). *)</p></td></tr><tr id="type-fix_engine_state.fe_history" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_history" class="anchor"></a><code>fe_history : <a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list;</code></td><td class="doc"><p>(** We maintain history of our outgoing messages in case we're asked to retransmit. *)</p></td></tr><tr id="type-fix_engine_state.fe_last_time_data_sent" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_last_time_data_sent" class="anchor"></a><code>fe_last_time_data_sent : <a href="../../core/Datetime/index.html#type-fix_utctimestamp">Datetime.fix_utctimestamp</a>;</code></td><td class="doc"><p>(** Last time we sent out data to the corresponding engine *)</p></td></tr><tr id="type-fix_engine_state.fe_last_data_received" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_last_data_received" class="anchor"></a><code>fe_last_data_received : <a href="../../core/Datetime/index.html#type-fix_utctimestamp">Datetime.fix_utctimestamp</a>;</code></td><td class="doc"><p>(** Last time we received a heartbeat or other message. *)</p></td></tr><tr id="type-fix_engine_state.fe_heartbeat_interval" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_heartbeat_interval" class="anchor"></a><code>fe_heartbeat_interval : <a href="../../core/Datetime/index.html#type-fix_duration">Datetime.fix_duration</a>;</code></td><td class="doc"><p>(** Negotiated heartbeat interval. *)</p></td></tr><tr id="type-fix_engine_state.fe_testreq_interval" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_testreq_interval" class="anchor"></a><code>fe_testreq_interval : <a href="../../core/Datetime/index.html#type-fix_duration">Datetime.fix_duration</a>;</code></td><td class="doc"><p>(** Interval used to 'pad' heartbeat interval before a TestRequest message is sent out. *)</p></td></tr><tr id="type-fix_engine_state.fe_retransmit_start_idx" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_retransmit_start_idx" class="anchor"></a><code>fe_retransmit_start_idx : int;</code></td><td class="doc"><p>(** Starting index of the retransmitting history. *)</p></td></tr><tr id="type-fix_engine_state.fe_retransmit_end_idx" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_retransmit_end_idx" class="anchor"></a><code>fe_retransmit_end_idx : int;</code></td><td class="doc"><p>(** Ending index ... *)</p></td></tr><tr id="type-fix_engine_state.fe_history_to_send" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_history_to_send" class="anchor"></a><code>fe_history_to_send : <a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list;</code></td><td class="doc"><p>(** Used in message retransmission. *)</p></td></tr><tr id="type-fix_engine_state.fe_mode_after_resend" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_mode_after_resend" class="anchor"></a><code>fe_mode_after_resend : <a href="index.html#type-fix_engine_mode">fix_engine_mode</a>;</code></td><td class="doc"><p>(** Which mode should we go to after resend is completed? *)</p></td></tr><tr id="type-fix_engine_state.fe_application_up" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_application_up" class="anchor"></a><code>fe_application_up : bool;</code></td><td class="doc"><p>(** Is the application that's receiving messages up and running?
TODO: we might need to constitute a heartbeat to enforce this. *)</p></td></tr><tr id="type-fix_engine_state.last_test_req_id" class="anchored"><td class="def field"><a href="#type-fix_engine_state.last_test_req_id" class="anchor"></a><code>last_test_req_id : int;</code></td><td class="doc"><p>(** These are used to send out TestRequest messages that should be replied
with Heartbeat messages containing the testrequest ID. Any string
may be used, we use int's for now. *)</p></td></tr><tr id="type-fix_engine_state.fe_num_logons_sent" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_num_logons_sent" class="anchor"></a><code>fe_num_logons_sent : int;</code></td><td class="doc"><p>(** Number of logons sent during session initialization. This is done to
ensure that the engine does not go into infinite loop. *)</p></td></tr><tr id="type-fix_engine_state.fe_max_num_logons_sent" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_max_num_logons_sent" class="anchor"></a><code>fe_max_num_logons_sent : int;</code></td><td class="doc"><p>(** Setting: maximum number of logons to be sent out. *)</p></td></tr><tr id="type-fix_engine_state.fe_encrypt_method" class="anchored"><td class="def field"><a href="#type-fix_engine_state.fe_encrypt_method" class="anchor"></a><code>fe_encrypt_method : <a href="../../protocol/Full_admin_enums/index.html#type-fix_encryption_method">Full_admin_enums.fix_encryption_method</a>;</code></td></tr></table><code>}</code><code></code></div><div class="doc"><p>Engine state structure containing all of the information required for it operate.</p></div></div><div class="spec val" id="val-init_fix_engine_state"><a href="#val-init_fix_engine_state" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>init_fix_engine_state : <a href="index.html#type-fix_engine_state">fix_engine_state</a></code></div><div class="doc"><p>Initial engine state.</p></div></div><div class="spec val" id="val-engine_state_busy"><a href="#val-engine_state_busy" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>engine_state_busy : <a href="index.html#type-fix_engine_state">fix_engine_state</a> <span class="keyword">&#8209;&gt;</span> bool</code></div><div class="doc"><p>THEOREM: one_step calls on busy state eventually terminate</p></div></div><div class="spec val" id="val-is_state_valid"><a href="#val-is_state_valid" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>is_state_valid : <a href="index.html#type-fix_engine_state">fix_engine_state</a> <span class="keyword">&#8209;&gt;</span> bool</code></div><div class="doc"><p>Properties of a valid state.</p><p>TODO: augment these properties and verify that if we're in a good state, cannot
transition out of it (i.e. new state would always be valid).</p><p>TODO: once we have the full library of checks for incoming messages
we need to maintain that every state transition from a valid state
would result in another valid state.</p></div></div></body></html>