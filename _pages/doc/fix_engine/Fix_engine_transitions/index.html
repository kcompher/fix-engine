<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Fix_engine_transitions (fix_engine.Fix_engine_transitions)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><meta name="generator" content="doc-ock-html v1.0.0-1-g1fc9bf0"/></head><body><nav id="top"><a href="../index.html">Up</a> &mdash; <span class="package">package <a href="../index.html">fix_engine</a></span></nav><header><h1><span class="keyword">Module</span> <span class="module-path">Fix_engine_transitions</span></h1></header><p>FIX 4.4 engine transition functions.</p><div class="spec val" id="val-logoff_and_shutdown"><a href="#val-logoff_and_shutdown" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>logoff_and_shutdown : <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a> <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>In many abnormal cases we need to send out the Logout messages and
transition to ShutdownInitiated state.</p></div></div><div class="spec val" id="val-make_resend_message"><a href="#val-make_resend_message" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>make_resend_message : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../../core/Datetime/index.html#type-fix_utctimestamp">Datetime.fix_utctimestamp</a><span class="keyword"> * </span>int) <span class="keyword">&#8209;&gt;</span> <a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a></code></div><div class="doc"><p>Before sending out a historic message, we need to:
</p><ul><li>move the sequence number if it is too low</li><li>set PossibleDuplicate flag</li><li>move historic SendingTime to OrigSendingTime</li><li>update SendingTime</li></ul></div></div><div class="spec val" id="val-run_retransmit"><a href="#val-run_retransmit" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_retransmit : <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a> <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>We're in the middle of retransmitting historic messages.
Note: when we transition into Retransmit mode, we set up a
queue with messages that should be sent out. These messages are a function
of the parameters that were sent to the engine.</p></div></div><div class="spec val" id="val-run_no_active_session"><a href="#val-run_no_active_session" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_no_active_session : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>Here we will only accept an incoming Logon message to establish a connection.</p></div></div><div class="spec val" id="val-run_logon_sequence"><a href="#val-run_logon_sequence" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_logon_sequence : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"></div></div><div class="spec val" id="val-initiate_Resend"><a href="#val-initiate_Resend" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>initiate_Resend : (<a href="../Fix_engine_state/index.html#type-fix_engine_mode">Fix_engine_state.fix_engine_mode</a><span class="keyword"> * </span><a href="../../protocol/Full_admin_messages/index.html#type-full_msg_resend_request_data">Full_admin_messages.full_msg_resend_request_data</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>Response to resend request. Note that we're copyng over the whole list of historic messages -
we will use the starting/ending indexes to ensure we're only sending out the right ones.
Perhaps there's a better way to do this - it's important that we always maintain the spirit
of 'one_step' - all operations are are atomic.</p></div></div><div class="spec val" id="val-attempt_sequence_reset"><a href="#val-attempt_sequence_reset" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>attempt_sequence_reset : (<a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a><span class="keyword"> * </span>int<span class="keyword"> * </span>int) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"></div></div><div class="spec val" id="val-run_active_session"><a href="#val-run_active_session" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_active_session : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>We're operating in a normal mode.</p></div></div><div class="spec val" id="val-run_wait_heartbeat"><a href="#val-run_wait_heartbeat" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_wait_heartbeat : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>We've force-requested a heartbeat message from the other end and waiting for it to come.
TODO: We're ignoring all other messages -- check the specs if that is a correct behavior</p></div></div><div class="spec val" id="val-run_gap_detected"><a href="#val-run_gap_detected" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_gap_detected : <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a> <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>We're in a GapDetected state. Sending out resend request and transitioning into Recovery.</p></div></div><div class="spec val" id="val-replay_single_msg"><a href="#val-replay_single_msg" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>replay_single_msg : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>Here we can only handle a subset of the FIX messages.</p></div></div><div class="spec val" id="val-run_cache_replay"><a href="#val-run_cache_replay" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_cache_replay : <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a> <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>Run the engine through the replay messages. This is used during recovery.</p><p>Note that the only session-level message we should receive at this point
should be a Reject message. We need to ensure that this function cannot
lead to another Recovery state.</p></div></div><div class="spec val" id="val-no_seq_gaps"><a href="#val-no_seq_gaps" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>no_seq_gaps : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list<span class="keyword"> * </span>int) <span class="keyword">&#8209;&gt;</span> bool</code></div><div class="doc"><p>Check to make sure there're no sequence gaps</p></div></div><div class="spec val" id="val-is_cache_complete"><a href="#val-is_cache_complete" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>is_cache_complete : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list<span class="keyword"> * </span>int) <span class="keyword">&#8209;&gt;</span> bool</code></div><div class="doc"><p>Is cache valid so that we can transition from recovery?</p><p>Cache is considered valid when:
1. It is non-empty
2. The sequence IDs of the messages within cache are continuous (i.e. there're no gaps)
3. First sequence ID (of the cache) is next message from the last one correctly processed.</p></div></div><div class="spec val" id="val-add_to_cache"><a href="#val-add_to_cache" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>add_to_cache : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list) <span class="keyword">&#8209;&gt;</span> <a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a> list</code></div><div class="doc"><p>Add message to cache so that ordering is maintained.</p></div></div><div class="spec val" id="val-run_recovery"><a href="#val-run_recovery" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_recovery : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>We're in recovery mode.
Logoff and ResendRequest messages must be processed.
We should add any other received messages are addted to the cache.
Transition to CacheReplay when the cahce is complete.</p></div></div><div class="spec val" id="val-run_shutdown"><a href="#val-run_shutdown" class="anchor"></a><div class="def val"><code><span class="keyword">val </span>run_shutdown : (<a href="../../protocol/Full_messages/index.html#type-full_valid_fix_msg">Full_messages.full_valid_fix_msg</a><span class="keyword"> * </span><a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a>) <span class="keyword">&#8209;&gt;</span> <a href="../Fix_engine_state/index.html#type-fix_engine_state">Fix_engine_state.fix_engine_state</a></code></div><div class="doc"><p>We've sent out a Logout message and are now waiting for a confirmation of logout.</p></div></div></body></html>